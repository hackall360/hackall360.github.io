---
interface Props {
  tags: string[];
}

const { tags } = Astro.props as Props;
---
<section
  data-project-filters
  data-motion-reveal
  data-motion-direction="up"
  class="mx-auto flex w-full flex-col gap-4 rounded-3xl border border-accent/15 bg-surface-elevated/70 p-6 shadow-inner-terminal"
>
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <h2 class="text-lg font-semibold text-white">Filter by focus area</h2>
    <button
      type="button"
      class="self-start rounded-full border border-transparent bg-surface-highlight/70 px-4 py-2 text-sm font-semibold text-neutral-emphasis transition duration-200 ease-spring-out hover:border-accent hover:text-accent-light focus-visible:outline-none"
      data-clear-filters
    >
      Clear filters
    </button>
  </div>
  <div class="flex flex-wrap gap-3" role="group" aria-label="Toggle project tags">
    {tags.map((tag) => (
      <button
        type="button"
        class="tag-filter inline-flex items-center gap-2 rounded-full border border-accent/20 bg-surface-overlay/80 px-4 py-2 text-sm font-semibold text-neutral-emphasis transition duration-200 ease-spring-out hover:border-accent hover:text-accent-light focus-visible:outline-none"
        data-tag={tag.toLowerCase()}
        aria-pressed="false"
      >
        <span aria-hidden="true" class="indicator size-2 rounded-full bg-neutral-soft transition"></span>
        {tag}
      </button>
    ))}
  </div>
</section>

<script is:inline>
  const container = document.currentScript?.parentElement;
  if (!container) {
    throw new Error('ProjectFilters container not found');
  }

  const buttons = Array.from(
    container.querySelectorAll('button[data-tag]')
  );
  const clearButton = container.querySelector('[data-clear-filters]');

  const toggleButtonState = (button, active) => {
    button.setAttribute('aria-pressed', active ? 'true' : 'false');
    button.classList.toggle('border-accent', active);
    button.classList.toggle('bg-accent/20', active);
    button.classList.toggle('text-accent-light', active);
    button.classList.toggle('shadow-glow', active);

    const indicator = button.querySelector('.indicator');
    if (indicator) {
      indicator.classList.toggle('bg-accent-light', active);
      indicator.classList.toggle('bg-neutral-soft', !active);
    }
  };

  const update = () => {
    const activeTags = buttons
      .filter((button) => button.getAttribute('aria-pressed') === 'true')
      .map((button) => button.dataset.tag ?? '')
      .filter(Boolean);

    container.dispatchEvent(
      new CustomEvent('filtersChange', {
        bubbles: true,
        detail: { activeTags }
      })
    );
  };

  buttons.forEach((button) => {
    button.addEventListener('click', () => {
      const isActive = button.getAttribute('aria-pressed') === 'true';
      toggleButtonState(button, !isActive);
      update();
    });

    button.addEventListener('keydown', (event) => {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        const isActive = button.getAttribute('aria-pressed') === 'true';
        toggleButtonState(button, !isActive);
        update();
      }
    });
  });

  clearButton?.addEventListener('click', () => {
    buttons.forEach((button) => {
      toggleButtonState(button, false);
    });
    update();
  });

  update();
</script>
